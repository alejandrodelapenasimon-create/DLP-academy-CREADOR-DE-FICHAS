<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Exámenes PDF</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- HEADER -->
<header class="bg-red-700 p-6 text-center shadow-md transition-colors duration-500">
  <h1 class="text-3xl font-bold text-white flex justify-center items-center gap-4">
     <i class="fa-solid fa-clock text-4xl"></i>
     Generador de Exámenes
  </h1>
  <p class="text-red-100 mt-2">
    Sube imágenes y genera un examen en PDF
  </p>
</header>

<main class="w-full max-w-6xl mx-auto p-8 flex-grow">

  <!-- FORMULARIO -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

    <div>
      <label class="block font-bold mb-2 text-gray-700">Curso</label>
      <input id="curso"
        class="w-full p-4 border rounded-xl shadow-sm
               focus:ring-2 focus:ring-red-500 focus:outline-none"
        placeholder="Ej: 4º ESO">
    </div>

    <div>
      <label class="block font-bold mb-2 text-gray-700">Tiempo del examen</label>
      <select id="tiempo"
        class="w-full p-4 border rounded-xl font-bold shadow-sm
               focus:ring-2 focus:ring-red-500 focus:outline-none bg-white">
        <option value="">Selecciona tiempo</option>
        <option value="45">45 minutos</option>
        <option value="60">1 hora</option>
        <option value="90">1:30 horas</option>
      </select>
    </div>

  </div>

  <!-- DROPZONE -->
  <div id="dropZone" 
    class="group w-full min-h-[45vh] flex flex-col justify-center items-center 
           border-4 border-dashed border-red-400 rounded-2xl p-6 cursor-pointer 
           bg-white shadow-sm
           transition-all duration-500
           hover:bg-gradient-to-br hover:from-red-50 hover:to-red-100 hover:border-red-600">
    
    <!-- ICONO NUEVO -->
    <div
      class="text-7xl mb-6 text-red-400
             transition-all duration-500 transform
             group-hover:text-red-700
             group-hover:scale-110 group-hover:rotate-3">
      <i class="fa-solid fa-file-arrow-up"></i>
    </div>

    <p id="fileName"
       class="text-2xl font-medium text-center px-4
              transition-colors duration-500">
      Toca o arrastra una o varias imágenes del solucionario
    </p>

    <input id="fileInput" type="file" accept="image/*" multiple hidden>
  </div>

  <!-- BOTÓN -->
  <div class="text-center mt-8">
    <button onclick="enviarAN8N()" 
      class="bg-red-700 hover:bg-red-800 text-white font-bold
             py-4 px-12 rounded-xl text-xl shadow-lg
             transition transform hover:-translate-y-1">
      Generar examen en PDF
    </button>
  </div>

</main>

<script>
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");
const fileName = document.getElementById("fileName");

let archivos = [];

// CLICK
dropZone.addEventListener("click", () => fileInput.click());

// DRAG VISUAL
dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('bg-red-50', 'border-red-600');
});

dropZone.addEventListener('dragleave', e => {
    e.preventDefault();
    dropZone.classList.remove('bg-red-50', 'border-red-600');
});

dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('bg-red-50', 'border-red-600');
    if (e.dataTransfer.files.length > 0) {
        archivos = [...e.dataTransfer.files];
        actualizarTextoArchivos();
    }
});

fileInput.addEventListener("change", () => {
    archivos = [...fileInput.files];
    actualizarTextoArchivos();
});

function actualizarTextoArchivos() {
    fileName.innerHTML =
      `<span class="font-bold text-red-800">
        ${archivos.length} imagen(es) lista(s)
       </span>`;
}

// ENVÍO
function enviarAN8N() {
  const curso = document.getElementById("curso").value;
  const tiempo = document.getElementById("tiempo").value;

  if (!curso || !tiempo || archivos.length === 0) {
    alert("Completa todos los campos y sube al menos una imagen.");
    return;
  }

  const btn = document.querySelector('button');
  const originalText = btn.innerText;
  btn.innerText = "Generando...";
  btn.disabled = true;
  btn.classList.add('opacity-75', 'cursor-not-allowed');

  const formData = new FormData();
  formData.append("curso", curso);
  formData.append("tiempo", tiempo);

  archivos.forEach((file, i) => {
    formData.append(`imagen_${i}`, file);
  });

  fetch("https://podzolic-dorethea-rancorously.ngrok-free.dev/webhook/711e538b-9d63-42bb-8494-873301ffdf39", {
    method: "POST",
    body: formData
  })
  .then(res => res.blob())
  .then(blob => {
    const url = window.URL.createObjectURL(blob);
    window.open(url);
  })
  .catch(err => {
    console.error(err);
    alert("Error al generar el PDF");
  })
  .finally(() => {
    btn.innerText = originalText;
    btn.disabled = false;
    btn.classList.remove('opacity-75', 'cursor-not-allowed');
  });
}
</script>
<footer class="p-3 text-center text-xs text-gray-400 bg-gray-100 flex-none">
    © 2025 DLP Academy Tool
</footer>
</body>
</html>


